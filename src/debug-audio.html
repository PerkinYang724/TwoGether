<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0b1220;
            color: white;
            padding: 20px;
        }

        button {
            background: #0ea5e9;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background: #0284c7;
        }

        .log {
            background: #1e293b;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>

<body>
    <h1>Audio Debug Test</h1>
    <p>This page tests audio playback functionality to debug the music trigger issue.</p>

    <button onclick="testDirectAudio()">Test Direct Audio Playback</button>
    <button onclick="testFetchAudio()">Test Audio File Access</button>
    <button onclick="testUserInteraction()">Test User Interaction Audio</button>
    <button onclick="clearLog()">Clear Log</button>

    <div id="log" class="log"></div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('log').textContent = '';
        }

        async function testDirectAudio() {
            log('ðŸŽµ Testing direct audio playback...');
            try {
                const audio = new Audio('/music/music-for-intro.mp3');
                audio.volume = 0.3;
                audio.loop = true;

                log('ðŸŽµ Audio element created');
                log('ðŸŽµ Audio src: ' + audio.src);
                log('ðŸŽµ Audio volume: ' + audio.volume);

                // Add event listeners
                audio.addEventListener('loadstart', () => log('ðŸŽµ Audio loadstart'));
                audio.addEventListener('loadedmetadata', () => log('ðŸŽµ Audio loadedmetadata'));
                audio.addEventListener('canplay', () => log('ðŸŽµ Audio canplay'));
                audio.addEventListener('canplaythrough', () => log('ðŸŽµ Audio canplaythrough'));
                audio.addEventListener('play', () => log('ðŸŽµ Audio play event'));
                audio.addEventListener('error', (e) => {
                    log('ðŸŽµ Audio error: ' + e.type);
                    log('ðŸŽµ Error details: ' + JSON.stringify({
                        error: e,
                        networkState: audio.networkState,
                        readyState: audio.readyState
                    }));
                });

                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    await playPromise;
                    log('ðŸŽµ Audio playing successfully!');
                } else {
                    log('ðŸŽµ Audio play() returned undefined');
                }
            } catch (error) {
                log('ðŸŽµ Audio playback failed: ' + error.message);
                log('ðŸŽµ Error type: ' + error.name);
            }
        }

        async function testFetchAudio() {
            log('ðŸŽµ Testing audio file access...');
            try {
                const response = await fetch('/music/music-for-intro.mp3', { method: 'HEAD' });
                log('ðŸŽµ Fetch response: ' + response.status + ' ' + response.statusText);
                log('ðŸŽµ Content-Type: ' + response.headers.get('content-type'));
                log('ðŸŽµ Content-Length: ' + response.headers.get('content-length'));
            } catch (error) {
                log('ðŸŽµ Fetch failed: ' + error.message);
            }
        }

        async function testUserInteraction() {
            log('ðŸŽµ Testing user interaction audio (mobile-friendly)...');
            try {
                // This simulates what happens in the welcome page
                const audio = new Audio('/music/music-for-intro.mp3');
                audio.volume = 0.3;
                audio.loop = true;
                audio.preload = 'auto';

                log('ðŸŽµ User interaction audio created');

                // Try to play immediately after user interaction
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    await playPromise;
                    log('ðŸŽµ User interaction audio playing successfully!');
                } else {
                    log('ðŸŽµ User interaction audio play() returned undefined');
                }
            } catch (error) {
                log('ðŸŽµ User interaction audio failed: ' + error.message);
                log('ðŸŽµ Error type: ' + error.name);
            }
        }

        // Log initial state
        log('ðŸŽµ Audio debug test page loaded');
        log('ðŸŽµ User agent: ' + navigator.userAgent);
        log('ðŸŽµ Current URL: ' + window.location.href);
    </script>
</body>

</html>